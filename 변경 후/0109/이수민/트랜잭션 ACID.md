## 트랜잭션이란?

데이터베이스의 작업을 처리하는 단위이다. 애플리케이션 또는 프로그램이 데이터베이스의 데이터를 읽기, 쓰기를 논리적 단위로 그룹화하는 방법이며, 트랜잭션은 성공(commmit)하거나 실패(Rollback)된다. </br> </br>

트랜잭션의 간단한 예는 계좌이체이다. </br>
사용자 A의 계좌의 금액을 사용자 B.에게 전송하는 작업은 데이터베이스의 작업인 트랜잭션이며, 트랜잭션이 정상적으로 처리되기 위해서는 트랜잭션의 특성인 **ACID**를 충족해야한다.


# 트랜잭션 종류 - ACID
## 원자성(Atomicity)
데이터베이스 트랜잭션의 All or Nothing을 의미한다. 즉, 데이터 베이스의 연산이 전부 실행되거나 또는 전혀 실행되지 않아야한다. </br></br>

예시로 </br>
사용자 A의 계좌에서 돈을 사용자 B에게 이체하는 경우 이체가 되거나 이체되지 않아야한다. </br>
이체하는 과정에서 전산 오류가 발생하여 데이터베이스에서 사용자 A의 돈을 사용자 B에게 전송하지 못하면, 원래 초기 상태(이체하기 이전 상태)로 돌아간다. </br>


## 일관성(Consistency)
트랜잭션이 데이터 무결성에 대한 제약 조건과 호환되어야 함을 의미한다. 즉, 데이터는 모순이 없어야한다. </br>
트랜잭션이 제약 조건을 위반하는 경우 일관성을 통해 트랜잭션이 실행되지 않고 이전의 상태로 돌아간다. </br> </br>

예시로 </br>
내 계좌가 마이너스 잔액을 허용하지 않는다고 가정한다. 여기서 제약조건은 "마이너스 잔액을 허용하지 않음" 이다. 즉, 잔액은 0원 미만이 될 수없다. </br>
내 계좌에 100만원이 있고 200만원의 제품을 구매하려고 한다. </br>
마이너스 잔액을 허용한다면 제품을 구매할 수 있지만, 내 계좌는 제약 조건이 존재하므로 구매하는 작업은 거부가 된다. </br>

## 고립성(Isolation)
동시 트랜잭션을 처리하는데 사용된다. 데이터는 매우 빠른 속도로 처리되므로 사용자 입장에서는 잘 모르지만, 여러 사용자가 동시에 테이블을 쓰거나 읽는 트랜잭션이 발생할 수 있다.</br>
동일한 테이블의 데이터를 수정하는 두 개의 트랜잭션이 동시에 발생하면 문제가 발생할 수 있다. </br>
고립성은 이러한 트랜잭션이 "직렬화" 되도록하여 다른 트랜잭션이 하나의 트랜잭션을 완료될 때까지 대기함을 의미한다.</br></br>

여기서 직렬화는 동시에 접근했지만, 순차적으로 처리하는 과정을 말한다. </br></br>

예시로 </br>
두 고객이 전자 상거래 웹사이트(위메프, 11번가, 옥션 등)에서 제품을 동시에 구매하려고 하는데 재고가 하나 남았다고 가정한다. </br>
DB가 두 고객이 동시에 제품을 구매할 수 있도록 허용하면 문제가 발생한다. </br>

고립성은 이러한 경우를 순서대로 배치하여 다른 작업을 시작하려면 작업중 하나를 완료해야한다. </br></br>

즉, 동시에 구매 요청을 했지만, 트랜잭션을 순차적으로 처리하였기 때문에 한 명은 구매가 성공하였으며, 구매하는 과정에서 재고가 0개가 되었으므로 남은 한 명은 제품 구매가 되지 않는다. </br>


## 지속성(Durability)
트랜잭션이 완료되면 이 트랜잭션으로 인한 결과는 영구적임을 보장한다. 트랜잭션이 정상적으로 완료되었으므로 정전과 같은 시스템 장애의 영향을 받지 않는다. </br>
만약, 트랜잭션 실행 도중 정전이 발생했으면, 원자성에 의해 트랜잭션이 실패(Rollback) 되어야 한다. </br>
완료된 트랜잭션은 **비휘발성 메모리** 에 저장된다. </br></br>

예시로 </br>
내 계좌에 100만원이 있고 50만원이 다른 계좌로 이체한다고 가정해본다. 이체가 정상적으로 되었으면, 내 계좌는 50만원으로 줄어든다. </br>
잔액을 다시 확인해봤을때, 100만원이 있는 경우는 이체하는 과정의 문제이며 지속성은 이러한 문제가 발생하지 않음을 보장한다. 



### Transaction 상태 
![트랜잭션 상태](https://user-images.githubusercontent.com/58407737/211234862-54b5c70a-3c9b-4526-bb6b-173efa491f67.png)


</br>

### Transaction 예제
![트랜잭션 코드](https://user-images.githubusercontent.com/58407737/211234587-668254a7-de38-4ec7-8d72-deaa1d550bee.png)

 
