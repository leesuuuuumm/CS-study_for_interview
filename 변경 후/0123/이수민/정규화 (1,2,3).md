## 정규화가 생겨나게 된 배경
한 릴레이션에 여러 엔티티의 속성을 혼합하면 정보가 중복되며 저장 공간을 낭비한다. 중복된 정보로 인해 '이상 현상'이 발생하게 된다. </br>
이러한 문제를 해결하기 위해 정규화 과정을 거치는 것이다.
</br>
</br>

# 정규화(Normalization)란?

데이터 중복을 줄이기 위해 데이터베이스를 구성하고 구조화하는 프로세스이다. </br>
-> 중복된 데이터를 허용하지 않음으로써 무결성(Integrity)를 유지할 수 있으며, DB 용량도 줄일 수 있다.</br>

이상현상(삽입, 삭제, 갱신)이 있는 릴레이션을 분해하여 이상현상을 없애는 과정이다. </br>

이상현상이 존재하는 릴레이션을 분해하는 여러 개의 릴레이션을 생헝하게 된다. </br>

이를 단계별로 구분하여 정규형이 높아질수록 이상현상을 줄어들게 된다. </br>

## 장점
1. **데이터베이스 크기 감소** -> 중복된 데이터 허용하지 않아 무결성 유지, DB 용량 줄일 수 있다.
2. **데이터베이스 변경 시 이상 현상 제거할 수 있다.**
3. **유지보수 용이** -> 정규화된 데이터베이스 구조에서는 새로운 데이터 형의 추가로 인한 확장시, 그 구조를 변경하지 않아도 되거나 일부만 변경해도 된다.


## 단점
1. 릴레이션의 분해로 인해 릴레이션 간의 JOIN 연산이 많아진다.
2. SQL에 대한 응답 시간이 느려질 수도 있다.
-> 데이터 중복속성을 제거하고 결정자에 의해 동일한 의미의 일반 속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과가 있다. </br>

따라서 데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수도 있다. </br>

그래서 JOIN이 많이 발생하여 성능 저하가 나타나면 반정규화(De-Normalization)를 적용할 수도 있다.



## 제 1 정규화
- 테이블의 컬럼이 **원자값(Atomic Value, 하나의 값)을 갖도록** 테이블을 분해하는 것이다. </br> 

### 규칙
1. 각 컬럼이 하나의 속성만을 가져야 한다.
2. 하나의 컬럼은 같은 종류나 타입(type)의 값을 가져야 한다.
3. 각 컬럼은 unique한 이름을 가져야한다.
4. 칼럼의 순서가 상관없어야 한다.

### (예시) </br>
**테이블: 고객**  </br> 

![image](https://user-images.githubusercontent.com/58407737/213953982-d8cf2ccb-3157-4622-9c61-8cdd90c74d81.png)

추신수, 박세리는 여러 개의 취미를 가지고 있기 때문에 제 1 정규형을 만족하지 못하고 있다. 이때 제 1 정규화를 통해 분해 한다. </br>

![image](https://user-images.githubusercontent.com/58407737/213954229-5cd19205-9eb0-4261-b814-7748329e28a6.png)


## 제 2 정규화
- **제 1 정규화를 진행한** 테이블에 대해 **완전 함수 종속을 만족**하도록 테이블을 분해하는 것이다.
- 완전 함수 종속: **기본키의 부분집합이 결정자가 되어선 안된다는 것** 이다. </br> 

### 규칙
1. 1정규형을 만족해야한다.
2. 모든 컬럼이 부분적 종속(Partial Dependency)이 없어야한다 == 모든 칼럼이 완전 함수 종속을 만족해야한다.
 
</br> **기본키가 하나의 속성이라면 2 정규형도 만족한다.** </br> 



### (예시)

![image](https://user-images.githubusercontent.com/58407737/213954691-bc49ba5c-8a6b-4615-af2c-1434e96c0b53.png)

이 테이블에서 기본키는 (학생번호, 강좌이름)으로 복합키이다. 그리고 (학생번호, 강좌이름)인 기본키는 성적을 결정하고 있다. </br>
(학생번호, 강좌이름) --> (성적) </br>

그런데 여기서 강의실이라는 칼럼은 기본키의 부분집합인 강좌이름에 의해 결정될 수 있다. (강좌이름) --> (강의실) </br>
즉, 기본키(학생번호, 강좌이름)의 부분키인 강좌이름이 결정자이기 때문에 기존의 테이블에서 강의실을 분해하여 별도의 테이블로 나눠 제 2 정규형을 만족한다. </br>

![image](https://user-images.githubusercontent.com/58407737/213957173-5eb36a9d-be35-495e-85fb-23b56f687200.png)

## 제 3 정규형 
- **제 2 정규형을 진행한** 테이블에 대해 **이행적 종속을 없애도록** 테이블을 분해하는 것이다. </br>
- 이행적 종속: A -> B, B -> C, A -> C 가 성립되는 것을 의미

### 규칙
1. 2 정규형을 만족해야 한다.
2. 키가 아닌 모든 애트리뷰트가 릴레이션 R의 기본키에 이행적으로 종속하지 않아야 한다.

### (예시1)

![image](https://user-images.githubusercontent.com/58407737/213957636-c40c872b-3493-4fb0-9cf9-5d1e903eddd3.png)


기존의 테이블에서 학생 번호는 강좌 이름을 결정하고, 강좌 이름은 수강료를 결정하고 있다. 그렇기 때문에 이를 (학생번호, 강좌이름) 테이블과 (강좌이름, 수강료) 테이블로 분해해야한다. </br>

이행적 종속을 제거하는 이유: </br>
예를 들어 501 학생이 수강하는 강좌가 스포츠경영학으로 변경되었을 때 이행적 종속이 존재한다면 501 학생은 스포츠 경영학이라는 15000원 수강료를 지불하는게 아니라 20000원의 수강료를 지불하게 된다. </br>
물론 강좌 이름에 맞게 수강료를 다시 변경 가능하지만, 이러한 번거로움을 해결하기 위해 제 3 정규화를 한다. </br>

즉, 학생 번호를 통해 강좌 이름을 참조하고, 강좌 이름으로 수강료를 참조하도록 테이블을 분해하야한다. 

![image](https://user-images.githubusercontent.com/58407737/213958408-befce56a-040a-4133-84b8-0f04b3af4256.png)


### (예시2)

![image](https://user-images.githubusercontent.com/58407737/213959291-5b3dadad-6f07-415e-817e-7da0e1c2c70f.png)

ID를 알면 등급을 알 수 있다. 등급을 알면 할인율을 알 수 있다. 따리서 ID를 알면 할인율을 알 수 있다. </br>
즉, 이행 중속성이 존재하므로 제 3 정규형을 만족하지 않는다. 



## BCNF 정규화
- 제 3정규화를 진행한 테이블에 대해 모든 결정자가 후보키가 되도록 테이블을 분해하는 것이다. 

### 규칙
1. 3 정규형을 만족해야 한다.
2. 모든 결정자가 후보키 집합에 속해야 한다.


</br> **3 정규형을 조금 더 강화시킨 개념** </br>

### (예시)

![image](https://user-images.githubusercontent.com/58407737/213961040-258b0ae4-0091-49e8-a25d-099b91fef9a6.png)

이상 현상이 발생 </br>
- 삽입: 새로운 교수가 특정 과목을 담당한다는 새로운 정보를 추가할 수 없다. 적어도 한 명 이상의 수강 학생이 필요하다.
- 삭제: 학번 100이 C234 과목을 취소하면, P2가 C234 과목을 담당하는 정보도 삭제 된다.
- 갱신: P1의 과목이 변경되면 P1인 행을 모두 찾아 변경시켜주어야 한다.

</br>
이상 현상이 생기는 이유 </br>
- 결정자가 후보키로 취급되고 있지 않기 때문이다.
</br>

후보키는 슈퍼키중에서 최소성을 갖는 키로 (학번, 과목명) 이나 (학번, 담당교수)가 후보키가 된다. </br>
단지, 담당 교수만으로는 후보키 될 수 없음 </br>
하지만, 후보키가 아님에도 과목명을 결정할 수 있기 때문에 담당 교수는 결정자에 속한다. </br></br>

그래서 모든 결정자는 항상 후보키가 되도록 릴레이션을 분해해주면 강한 제 3정규형 즉, BCNF를 만족한다. </br>


![image](https://user-images.githubusercontent.com/58407737/213961434-4d4b3d3a-0627-4b76-8ba5-706ef5daa42a.png)


</br>
</br>
</br>
</br>
</br>

참고 자료 </br>
https://jhnyang.tistory.com/360 </br>
https://rebro.kr/160 </br>
https://mangkyu.tistory.com/110 </br>
https://code-lab1.tistory.com/48 </br>



