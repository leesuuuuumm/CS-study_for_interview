<h1> 교착상태 </h1>

- 교착 상태란 2개 이상의 프로세스가 자원을 점유한 상태에서 서로 다른 프로세스가 점유하고 있는 자원을 요구하며, 서로의 자원이 끝나기만을 기다리며 둘 다 영원히 끝나지 않는 상황을 뜻한다.

<h1> DEADLOCK 발생 조건 </h1>

1. 상호배제(Mutual Exclusion)

- 한 번에 한 개의 프로세스만이 공유 자원을 사용할 수 있다.

2. 점유대기(Hold and Wait)

- 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다린다.

3. 비선점(No preemption)

- 프로세스가 어떤 자원의 사용을 끝날 때까지 그 자원을 뺏을 수 없다.

4. 순환대기(Circular wait)

- 각 프로세스는 순환적으로 다음 프로세스가 요구되는 자원을 가지고 있다.

<h1> 교착상태 해결 방법 </h1>

- 교착상태는 위 4가지 조건을 모두 만족할 때 발생한다.
- 대부분의 접근들은 4개중 하나를 막음으로써 동작하며, 특히 4번째 것을 막음으로서 동작한다.

<h1> 교착상태의 예방 </h1>

1.  상호배제 조건의 제거

- 교착상태는 2개 이상의 프로세스가 공유 불가능한 자원을 사용하니 발생하는 것이므로, 공유 불가능한, 즉, 상호 배제 조건을 제거하면 교착 상태를 제거할 수 있다.

2. 점유와 대기 조건 제거

- 한 프로세스에 수행되기 전에 모든 자원을 할당시키고 나서 점유하지 않을 때는 다른 프로세스가 자원을 요구하도록 하는 방법이다.

3. 비선점 조건의 제거

- 비선점 프로세스에 대해 선점 가능한 프로토콜을 만들어 준다.

4. 순환 대기 조건의 제거

- 자원 유형에 따라 순서를 매긴다.

- 위 교착 상태들의 해결 방법은 자원 사용의 효율성이 떨어지고 비용이 많이 드는 문제점이 있다.

<h1> 교착 상태의 회피 </h1>

- 자원이 어떻게 요청될지에 대한 추가 정보를 제공하도록 요구하는 것으로, 시스템에 circular wait가 발생하지 않도록 자원 할당 상태를 검사한다.

- 교착 상태 회피하기 위한 알고리즘으로 크게 2가지가 있다.
- 1) 자원 할당 그래프 알고리즘
- 2) 은행원 알고리즘

<h1> 은행원 알고리즘(Banker's Algorithm) </h1>

- 다익스트라가 제안한 기법으로, 은행에서 모든 고객의 요구를 충족할 수 있도록 현금을 대출해주는 것에서 유래했다.
- 은행원 알고리즘은 자원 할당 결정 전에 예상되는 몯느 자원의 최대 할당량을 가지고 시뮬레이션을 하여 safe state에 들 수 있는지 여부를 검사하여 교착 상태의 가능성을 미리 조사하는 알고리즘이다.
- 기본 개념 자체는 <b> "CPU는 최소한 하나의 프로세스에게 할당해줄 만큼의 자원을 항상 보유하고 있어야 한다. </b> 입니다.

</br>

<예시> 시스템은 총 12개의 자원을 가지고 있다고 가정 </br>

![image](https://user-images.githubusercontent.com/62228401/229319291-ea67e739-7655-49aa-8e41-d74e82e5205f.png)

<br />

- 현재 할당 중인 자원량의 합은 <b> 5 + 2 + 2 = 9 </b> 입니다.
- 시스템은 총 12개의 자원을 가지고 있으므로 현재 상태에서 가용 자원량은 <b> 12 - 9 = 3 </b> 이 됩니다.
- 여기서 가용 자원을 어느 프로세스에게 할당해주느냐에 따라서 자원을 효율적으로 이용할 수 있게 됩니다.
<br />

- 남은 가용자원 3개를 P1에게 할당 => <b> 가용 자원은 3 - 2 = 1 </b>
- P1의 작업이 끝나고 할당되어 있던 자원 4개 반납 => <b> 가용 자원은 1 + 4 = 5 </b>
- 남은 가용 자원 5개를 p0에게 할당 => <b> 가용 자원은 5 - 5 = 0 </b>
- p0의 작업이 끝나고 할당되어 있던 자원 10개 반납 => <b> 가용 자원은 0 + 10 = 10 </b>
- 남은 가용 자원 10개 중 7개를 p2에게 할당 => <b> 가용 자원은 10 - 7 = 3 </b>
- p2의 작업이 끝나고 할당되어 있던 자원 9개 반납 => <b> 가용 자원은 3 + 9 = 12 </b>

<br> 

이렇게 P1 - P0 - P2 순서로 자원 할당 시 Safe Sequence를 만족하게 된다. </br>

- 그러나 은행원 알고리즘의 경우 미리 자원의 최대 요구량을 알아야 하고, 핟당할 수 있는 자원의 수가 일정해야 하는 등 사용에 제약조건이 많다
- 이처럼 교착상태 회피 방법의 가장 큰 문제는 <u> 문제 발생에 대한 일관성과 가정이 완벽할 것이라는 것을 보장하기가 현실적으로 어렵다는 점</u> 입니다. 시스템의 규모가 작은 운영체제라면 고려해볼 만한 방법이지만, 멀티 리소스, 멀티 프로세스의 복잡한 운영체제 환경에서는 자원 할당 그래프를 분석하면서 Safe state를 파악하기가 상당히 어렵다.
<h1> 회복 </h1>

- 교착 상태가 발생했을 때 해결하는 기법

1. 사용자 처리

- 교착 상태에 있는 프로세스 중 하나의 프로세스를 사용자가 강제 종료

2. 시스템 처리

    1. 프로세스 중지
  
      - 교착 상태에 속해있는 모든 프로세스를 중지
      - 교착 상태가 해결될 때까지 한 프로세스를 중지

    2. 자원 선점

      - 프로세스들로부터 자원을 빼앗아 교착 상태가 해결될 때까지 다른 프로세스들에게 자원을 할당
