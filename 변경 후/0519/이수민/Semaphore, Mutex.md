## Why?
- 프로세스 간 메시지를 전송하거나, 공유 메모리를 통해 공유된 자원에 여러 개의 프로세스가 동시에 접근하면 Critical Section 문제가 발생하는데, 이를 해결하기 위해 상호배제를 해야한다. </br>

- ### 상호배제란? 
  - 임계 구역을 어느 시점에서 단 한개의 프로세스만이 사용하게하며, 다른 프로세스가 현재 사용중인 임계 구역에 접근하려고 할 때 이를 금지시켜주는 행위이다.

- 공유자원을 안전하게 관리하기 위해서는 상호배제를 달성하는 기법이 필요하다.

- Semaphore와 Mutex가 고안된 기법이고 이들은 동기화 도구이다.


</br>

# Mutex (뮤텍스)
- 공유된 자원의 데이터 혹은 임계영역 등에 하나의 Process 혹은 Thread가 접근하는 것을 막아준다.
- 임계구역을 가진 스레드들의 실행시간(Running Time)이 서로 겹치지 않고 각각 단독으로 실행되도록 하는 기술이다.

![image](https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/1deef826-47ae-4369-a143-4a1bd70f1128)

- 한 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제 기법이고, Key에 해당하는 어떤 객체가 있으며 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있다.
- 다중 프로세스들이 동기화(Synchronization) 또는 락(Lock)을 사용함으로써 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.

</br>

### (예시) - 화장실이 하나밖에 없는 식당
![image](https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/75755fee-dc0d-4214-8743-4e11fbadf604)

- 화장실을 가기 위해서는 카운터에서 열쇠를 받아 가야 하며, 키가 카운터에 있으면 사람이 없다는 뜻이고 그 열쇠를 이용해 화장실에 들어갈 수 있다.

- 카운터에 열쇠가 없으면 화장실에 누군가 있기 때문에 사용할 수 없어, 사용하려면 누군가가 나올 때까지 기다려야한다.
- 곧이어 다른 사람도 화장실에 가려고 카운터에서 대기하고 있다.
- 앞사람이 화장실에 나와 카운터에 키를 돌려놓고 기다리던 사람중 맨 앞에 있던 사람이 키를 받아 화장실에 간다.

</br>

- 이것이 뮤텍스가 동작하는 방식이다.
#### 화장실을 이용하는 사람: 프로세스 or 쓰레드
#### 화장실: 공유자원
#### 화장실 키: 공유자원에 접근하기 위해 필요한 어떤 오브젝트

- 즉, 뮤텍스는 key에 해당하는 어떤 오브젝트가 있으며 이 오브젝트를 소유한(스레드, 프로세드) 만이 공유자원에 접근할 수 있다.

</br>
</br>

# Semaphore (세마포어)
- 공유된 자원의 데이터 or 임계영역 등에 여러 Process or Thread가 접근하는 것을 막아준다. (동기화 대상이 하나 이상)

![image](https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/5c76283b-fd6f-43ec-858b-7a3dee40b9a8)

- 사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성한다.
- 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있으며, 각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다.
- 자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용하고, 이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면 재시도 전에 일정 시간을 대기한다.
- 일반적으로 비교적 긴 시간을 확보하는 리소스에 대해 사용하게 된다.

</br>

### (예시) - 화장실에 여러 개의 칸이 있는 식당

![image](https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/3d10580e-2dcd-4da8-a4c8-e54f50fca5fb)

- 화장실에 가고 싶으면 전광판에 적힌 빈 칸의 수를 확인하고 빈 칸이 1개 이상이라면 빈칸의 개수를 하나 뺀 다음에 화장실로 입장하고 나올때는 빈 칸의 개수를 하나 더해준다.
- 모든 칸에 사람이 들어갔을 경우 빈 칸의 개수는 0이 되며, 이때 화장실에 들어가고자 하는 사람이 있다면 빈 칸의 개수가 1 혹은 양수로 바뀔 때까지 기다려야한다.

</br>

#### 화장실: 공유자원
#### 사람들: 쓰레드 or 프로세스
#### 화장실 빈칸의 개수: 현재 공유자원에 접근할 수 있는 쓰레드, 프로세스의 개수 

- 이처럼 세마포어는 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성한다.



</br>
</br>

## 차이점: 동기화 대상의 개수(화장실 개수)
- Mutex는 동기화 대상이 오직 1개일 때 사용하며, Semaphore는 동기화 대상이 1개 이상일때 사용한다.
- Mutex는 자원을 소유할 수 있고 책임을 가지는 반면, Semaphore는 자원 소유가 불가하다.
- Mutex는 상태가 0, 1 뿐이므로 Lock을 가질 수 있고 소유하고 있는 스레드만이 Mutex를 해제할 수 있는 반면, Semaphore는 Semaphore를 소유하지 않는 스레드가 Semaphore를 해제할 수 있다.
- Mutex는 프로세스의 범위를 가지며 프로세스 종료될 때 자동으로 Clean up 되는 반면에, Semaphore는 시스템 범위에 걸쳐 있고 파일 시스템 상의 파일이 존재한다.

</br>

## 결론
- 뮤텍스, 세마포어는 모두 완벽한 기법이 아니여서 데이터 무결성을 보장할 수 없으며 모든 교착상태를 해결하지는 못한다. (무결성 보장 x, 데드락 발생 가능성)
- 하지만, 상호배제를 위한 기본적인 문법이며 여기에 좀 더 복잡한 매커니즘을 적용해 개선된 성능을 가질 수 있도록 하는 것이 중요하다.


