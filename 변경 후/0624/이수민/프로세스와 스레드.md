# 프로세스와 스레드
- 프로세스: 프로그램을 메모리상에서 실행중인 작업
- 스레드: 프로세스 안에서 실행되는 여러 흐름 단위

  
## 프로세스
사용자들이 더블클릭하면 OS가 프로그램을 실행시켜줘야 한다. </br>
그 프로그램을 실행 시키는 실행 주체를 인스턴스라 한다. </br>
프로그램의 하나의 인스턴스가 프로세스이다. </br>
프로그램을 실행하면 OS로부터 실행에 필요한 자원을 할당받아 프로세스가 된다. </br>
하나의 프로세스에 여러개의 인스턴스가 있을 수 있다. </br>

</br>

(예) word 실행파일 누르면 word 창이 뜨는데 실행파일은 하나인데 여러개의 word 창을 만들 수 있다. </br>
새로 만들기를 하면 word 창이 하나 더 생겨 작업 표시줄에 word가 두 개가 되어 동시 작업이 가능하다. </br>
- word실행파일: 프로그램 </br>
- word 창: 프로세스 </br>
실행파일을 눌러 CPU에 올라가서 실행되는 이 하나의 인스턴스를 프로세스라 한다. </br>
OS는 프로세스들에 고유의 PID 값을 붙여 관리한다. </br>
윈도우에서도 'Ctrl + alt + delete'를 누르면 작업관리자에서 현재 수행중인 프로세스들 확인할 수 있다. </br>

</br>

기본적으로 프로세스마다 최소 1개의 스레드 소유한다. (메인 스레드 포함)</br>

<img src="https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/def72c7b-22b5-466a-8ea6-78bd2e4f5b3f" align="center" width="45%">
<img src="https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/4c47c1d6-7e96-4e52-9280-15462c49ffec" align="center" width="45%">

</br>

### 할당 받는 시스템 자원의 예시
1. CPU 시간
2. 운영되기 위해 필요한 주소공간
3. Code, Data, Stack, Heap 구조로 되어 있는 독립된 메모리 영역

</br>

## 특징 
1. 프로세스는 각각 별도의 주소공간을 할당한다 (독립적) 
2. Code, Data, Stack, Heap 구조로 되어있는 독립된 메모리 영역을 할당 받는다. </br>
<b> (1) 코드(code)영역 </b> </br>
= 우리가 작성한 소스코드가 저장되는 영역으로 기계어 형태(0,1)로 저장 </br>
= 실행 파일을 구성하는 명령어들이 올라가는 메모리 영역으로 함수, 제어문, 상수 등이 여기에 지정된다. </br>
= CPU는 코드 영역에 저장된 명령어들을 하나씩 가져가서 실행한다. </br>
<b> (2) 데이터(Data)영역 </b> </br>
= 전역변수, static변수, 배열 등이 할당되는 영역 </br>
= 초기화 된 데이터는 data 영역에 저장 / 초기화 되지 않은 데이터는 bss 영역에 저장 </br>
= main함수 전에 선언되어 프로그램의 시작과 동시에 할당되고 프로그램이 종료되어야 메모리에서 소멸됨 </br>
  ```
  var a: Int = 10;	// 전역변수로 데이터 영역에 할당
  var b: Int = 20;	// 전역변수로 데이터 영역에 할당
  struct dataFunc(){
	static let data = "data" // 정적(static) 변수로 데이터 영역에 할당
  }
  ```
<b> (3) 힙(Heap)영역 </b> </br>
= 동적으로 할당된 변수가 할당되는 영역 (동적 할당 시 사용) </br>
= new(), malloc() </br>
<b> (4) 스택(Stack)영역 </b> </br>
= 함수 호출 시 생성되는 지역 변수와 매개 변수, 리턴값이 저장되는 영역 </br>
= 함수 호출이 완료되면 저장된 메모리도 해제됨 </br>
= 메모리 아래쪽 주소부터 할당되는 후입선출(LIFO) 구조 </br>
```
func add(_ a: Int, _ b: Int) -> Int {	// 파라미터 a,b 는 스택에 할당
      let result = a + b		// 지역변수 result는 스택에 할당
    return result
}
```
3. 각 프로세스는 별도의 주소 공간에 실행되며, 서로 독자적인 메모리 공간을 갖기 때문에 서로 메모리 공간을 공유할 수 없다. (다른 프로세스의 변수나 자료 구조에 접근할 수 없다.) 
4. 다른 프로세스의 자원에 접근하려면 프로세스간의 통신 IPC를 사용해야한다.

</br>

## 스레드 
![image](https://github.com/leesuuuuumm/CS-study_for_interview/assets/58407737/0d615fc9-808f-4c95-ae72-ba58a8d430d4) </br>

프로세스가 할당 받은 자원을 이용하는 실행 단위이자, 프로세스의 특정한 수행 경로이자, 프로세스 내에 실행되는 여러 흐름의 단위이다. </br>
프로세스 내에서 자원을 이용해 실제로 작업을 수행하는 일꾼같은 존재이다. </br>
프로세스는 최소 한 개 이상의 스레드를 가지며 이 스레드를 메인 스레드라고 한다. </br>

## 특징
1. 스레드는 stack만 따로 할당 받고 나머지 영역은 서로 공유한다.
2. 하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드 같이 생성한다.
3. 각각의 스레드는 별도의 레지스터와 스택을 가지지만, 힙 메모리는 서로 읽고 쓸 수 있다.
4. 한 스레드가 프로세스 자원을 변경하면, 다른 이웃 스레드도 그 변경 결과를 즉시 볼 수 있다.
5. 메모리의 공유하기 때문에 데드락, 동기화 문제가 발생할 수 있다.
6. 대부분의 현대 OS가 지원하고 있으며, 주 라이브러리는 POSIX pthreads, Windows threads, java theads 가 있다.

</br>

## 차이점
프로세스는 자신만의 고유 공간과 자원을 할당받아 사용하는데 반면, 스레드는 다른 스레드와 공간, 자원을 공유하면서 사용하는 차이가 존재한다.

## 프로세스 위주 VS 프로세스 - 스레드
- OS 설계 철학이 나옴 
- (1) Vutural Memory 주고 스레드가 공유해서 사용하는지, (2) 프로세스 단위 위주로 구사하는지? 효율적 논쟁이 있었다.
- (1)번은 Windows가 사용하는 정책이고, (2)번은 Linux가 사용는 것이 특징이다.
- Docker도 프로세스 단위로 사용


## 결론 
스레드마다 각자 고유한 TLS(Thread Local Storage)를 가지고 있으며, OS가 프로세스에게 제공된 공간의 범위에 한정된다.


</br>

## 멀티 스레드
- 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것
#### 장점
1. 안정성 - 독립된 구조
2. 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주자 않아, 작업속도가 느려지는 손해정도는 생기지만 정지되거나 하는 문제는 발생하지 않는다.

#### 단점
1. 독립된 메모리 영역이기 때문에 작업량이 많을수록 (context switching 이 자주 일어나서 주소 공간의 공유가 잦을 경우) 오버헤드가 발생하여 성능저하가 발생 할 수 있다.
2. context switching 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 등 오버헤드가 발생한다.
   

## 멀티 스레드
- 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것
- 스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해준다.
